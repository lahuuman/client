<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gian hàng Wibu</title>
    <link rel="stylesheet" href="../css/HTSP.css">
    <link rel="stylesheet" href="../css/main.css">
    <link rel="icon" type="image/x-icon" href="../asset/Logo.png" />
</head>
<body>
    <header id="headertuan">
        <a href="../html/main.html"><img id="icon-web" src="../asset/logo.png" alt=""></a>
        <div id="search-input">
            <input id="text-input-search" type="text" placeholder="Tìm kiếm">
            <button onclick="search()" id="search-button"><img style="height: 30px;" src="../asset/icon/loupe.png" alt=""></button>
            <div id="lam-mau">
                <img src="../asset/icon/uy_tin.png" alt=""><p>Mua 1 tặng 10</p>
                <img src="../asset/icon/hop_qua.png" alt=""><p>Bảo hành vĩnh viễn</p>
                <img src="../asset/icon/van_chuyen.png" alt=""><p>Free ship toàn quốc</p>
            </div>
        </div>
        <div id="user">
        </div>
        <div id="theme">
            <img onclick="darkLightMode()" id="img-theme" src="../asset/icon/dark_mode.png" alt="">
        </div>
    </header>
    <div id="danh-muc">
        <ul>
            <li onclick="all1()"><img src="../asset/category_img/dau saitama.png" alt=""><a href="#"><h3 class="darkMode">Tất Cả Sản Phẩm</h3></a></li>
            <li onclick="figure()"><img src="../asset/category_img/logo fairy tail.png" alt=""><a href="#"><h3 class="darkMode">Mô Hình Lẻ</h3></a></li>
            <li onclick="chibi()"><img src="../asset/category_img/ngoc rong 4 sao.png" alt=""><a href="#"><h3 class="darkMode">Mô Hình Chibi</h3></a></li>
            <li onclick="set()"><img src="../asset/category_img/pngtree-straw-hat-cartoon-illustration-png-image_6562738-removebg-preview.png" alt=""><a href="#"><h3 class="darkMode">Bộ Mô Hình</h3></a></li>
            <li onclick="cosplay()"><img src="../asset/category_img/kunai naruto.png" alt=""><a href="#"><h3 class="darkMode">Cosplay</h3></a></li>
        </ul>
        <h3 onclick="openTKNC()" id="TKNCp">Tìm kiếm nâng cao</h3>
        <div id="cart">
            <img src="../asset/icon/cart.png" alt="">
            <a href="../html/cart.html"><h3 class="darkMode">Giỏ Hàng</h3></a>
        </div>
        <div id="danh-muc-mobile">
            <p class="darkMode">Thể loại:</p>
            <select>
                <option value="0">Tất cả sản phẩm</option>
                <option value="1">Mô hình lẻ</option>
                <option value="2">Mô hình Chibi</option>
                <option value="3">Bộ mô hình</option>
                <option value="4">Cosplay</option>
            </select>
        </div>
    </div>
    <div id="banner-type">
        <div id="banner">
            <img src="../asset/banner_fl/5.png" alt="">
        </div>
        <div id="type">
            <h1 class="darkMode" id="type-output">Tất cả sản phẩm</h1>
        </div>
    </div>
    <div id="sort-filter-productPerPage">
        <div id="sort">
            <p class="xoa">Sort by:</p>
            <select class="option">
                <option value="nameup">Tăng dần theo tên</option>
                <option value="namedown">Giảm dần theo tên</option>
                <option value="priceup">Tăng dần theo giá</option>
                <option value="pricedown">Giảm dần theo giá</option>
            </select>
        </div>
        <div id="filter">
            <p class="darkMode">min</p><input class="option" id="min-price" type="number">
            <p class="darkMode">max</p><input class="option" id="max-price" type="number">
            <button onclick="filterbyprice()" class="option" id="loc-theo-gia">Lọc</p>
        </div>
        <div id="productPerPage">
            <p class="darkMode" id="hien-thi">Hiển thị:</p>
            <select>
                <option value="40">40 sản phẩm</option>
                <option value="20">20 sản phẩm</option>
                <option value="10">10 sản phẩm</option>
                <option value="5">5 sản phẩm</option>
                <option value="9999">Tất cả</option>
            </select>
        </div>
        <hr style="width: 99%;">
    </div>
    <div class="darkMode" id="so-luong"><p>1000 sản phẩm</p></div>
    <div id="archive-product"></div>
    <div id="phanTrang">
        
    </div>
    <div class="itemdetail"></div>
    <div class="infor_container">
        <div id="footer_logo">
            <img src="../asset/logo.png" alt="logo_footer">
        </div>
        <div id="social_media">
            <div class="footer_title"><strong>Truyền thông</strong></div>
            <hr>
            <p>
                <strong>Facebook:</strong>
                <a style="text-decoration: none; color: black;" href="https://www.facebook.com/">WIBU STORE</a>
            </p>
            <p>
                <strong>Youtube:</strong>
                <a style="text-decoration: none; color: black;" href="https://www.youtube.com/">WIBU STORE</a>
            </p>
            <p>
                <strong>Instagram:</strong>
                <a style="text-decoration: none; color: black;" href="https://www.instagram.com/">WIBU_STORE</a>
            </p>
        </div>
        <div id="introduce">
            <div class="footer_title"><strong>Giới thiệu</strong></div>
            <hr>
            <p>
                CƠ SỞ KINH DOANH MÔ HÌNH LỚN NHẤT THẾ GIỚI
            </p>
        </div>
        <div id="contact">
            <div class="footer_title"><strong>Thông tin liên hệ</strong></div>
            <hr>
            <p>
                <strong>Gmail:</strong>
                <a style="text-decoration: none; color: black;"
                    href="https://mail.google.com/mail/u/0/#drafts?compose=GTvVlcSGKZXNZFmbPpbnSJsmddvtGSScDzJxpQXtxshcNcslsZClTWPGrntrPTsJqvplgLVffSgzh">wibustore</a>
            </p>
            <p>
                <strong>Phone number:</strong>
                012345679
            </p>
        </div>
    </div>
    <footer>
        <p style="text-align: center;"><strong>Created by: </strong>Group 2</p>
    </footer>
    <div id="TKNCkhung"></div>
</body>
<script src="../js/item_detail.js"></script>
<script src="../js/cart.js"></script>
<script src="../js/add_product.js"></script>
<script src="../js/user_infor.js"></script>
<script src="../js/sign-in-up.js"></script>
<script>
    var productList = [];
    var productList2 = [];
    var kq = [];
    var productPerPage = 40;
    var currentPage  = 1;
    var productStored = localStorage.getItem('productList');
    if (productStored) productList = JSON.parse(productStored);
    productList2 = productList;
    kq = productList;
    function closeTKNC()
    {
        var c = document.getElementById("TKNCkhung");
        c.innerHTML="";
    }
    function searchTKNC()
    {
        var name = document.getElementById("inputNameTKNC").value.toLowerCase();
        var type = document.getElementById("inputTypeTKNC").value;
        var min = document.getElementById("inputMinTKNC").value;
        var max = document.getElementById("inputMaxTKNC").value;
        var checkPrice = /^[0-9]{1,15}$/;
        console.log(type);
        if (min !== "")
        {
            if (!checkPrice.test(min)) 
            {
                window.alert("Sai min");
                return;
            }
        }
        else min = 0;
        if (max !== "")
        {
            if (!checkPrice.test(max)) 
            {
                window.alert("Sai max");
                return;
            }
        }
        else max = Infinity;
        kq= [];
        if(type!=0)
        {
            for(var i = 0;i<productList.length;i++)
            {
                if(productList[i].name.toLowerCase().indexOf(name)>-1&&productList[i].price>=min&&productList[i].price<=max&&productList[i].type == type)
                kq.push(productList[i]);
            }   
        }
        else
        {
            for(var i = 0;i<productList.length;i++)
            {
                if(productList[i].name.toLowerCase().indexOf(name)>-1&&productList[i].price>=min&&productList[i].price<=max)
                kq.push(productList[i]);
            }
        }
        console.log(kq);
        phanTrang(1);
        closeTKNC();
    }
    function openTKNC()
    {
        var c = document.getElementById("TKNCkhung");
        c.innerHTML="";
        var b = document.createElement("div");
        b.id= "TKNC";
        b.innerHTML=
        `<h2 style="text-align: center;">Tìm kiếm nâng cao</h2>
        <div style="display: flex;">
            <div style="display: block;">
                <h3 class="h3TKNC">Tên sản phẩm</h3>
                <input id="inputNameTKNC" style="margin-left: 20px;" type="text" name="" id=""><br>
            </div>
            <div style="display: block; margin-left: 80px;">
                <h3 class="h3TKNC">Loại sản phẩm</h3>
                <select id="inputTypeTKNC" style="margin-left: 20px;">
                <option value="0">Tất cả</option>
                <option value="1">Mô hình lẻ</option>
                <option value="2">Mô hình chibi</option>
                <option value="3">Bộ mô hình</option>
                <option value="4">Cosplay</option>
                </select>
            </div>
        </div>
        <br>
        <div style="display: flex; margin-left: 20px;">
            <h4>Từ</h4> <input id="inputMinTKNC" type="text" placeholder="VNĐ">
            <h4>Đến</h4> <input id="inputMaxTKNC" style="margin-right: 20px" type="text"placeholder="VNĐ">
        </div>
        <br>
        <button onclick="searchTKNC()" style="float: right;">Tìm kiếm</button>
        <button onclick="closeTKNC()" style="float: right;">Hủy</button>`
        c.appendChild(b);
    }
    // hiển thị tên người dùng
    function displayUserName(){
        var user = document.getElementById("user");
        var currentUser = JSON.parse(localStorage.getItem("currentUser"));
        if(!currentUser) user.innerHTML="";
        else {
            if(currentUser.status){
                user.innerHTML = '<h2>'+currentUser.userName+'</h2>';
            }
            else user.innerHTML="";
        }
    }
    window.onload = function(){
        displayUserName();
    }
    // hiển thị sản phẩm
    function displayProduct(d)
    {
        var b = document.querySelector("#so-luong");
        b.innerHTML = 
        '<p>'+ kq.length +' sản phẩm</p>'
        var a = document.getElementById("archive-product");
        if(d.length == 0)
        {
            a.innerHTML = 
            '<h1>Không có sản phẩm theo yêu cầu</h1>';
            return;
        }
        a.innerHTML="";
        for(var i=0;i<d.length;i++)
        {   
            var b = document.createElement("div");
            b.className = "inner-product";
            b.setAttribute('onclick', 'showDetail2(this)');
            b.innerHTML =  
            '<div class="product-img"><img src="'+d[i].img+'" alt=""></div>'+
            '<div class="product-content">'+
                '<p class="name-product">'+d[i].name+'</p>'+
                '<p class="price-product">Giá: '+d[i].price+'đ</p>'+
            '</div>'
            a.appendChild(b);
        }
    }
    displayProduct(productList2)

    // Tìm kiếm bằng tên
    function search()
    {
        kq = [];
        var input = document.getElementById("text-input-search").value.toLowerCase();
        for(var i = 0; i<productList2.length;i++)
        if(productList2[i].name.toLowerCase().indexOf(input) > -1)
        kq.push(productList2[i]);
        phanTrang(1);
    }
    
    //tìm kiếm từ trang chủ
    var out = localStorage.getItem('mainSearch'); //nhận kết quả tìm kiếm từ local
    // var searchRtxt = document.getElementById('search_result_txt'); //hiển thị dòng kết quả: out
    var mainNameInput;
    out = JSON.parse(out);
    if (out != null) {
        if (out.name !== '')
            //hiển thị kết quả tìm kiếm
            // searchRtxt.innerHTML = 'kết quả tìm kiểm:<strong> ' + out.name + '</strong>.';
            mainNameInput = out.name;
        if (out.sign) {
            searchFromMain();
            var reSearch = {
                name:"",
                sign:false,
            }
            localStorage.setItem('mainSearch', JSON.stringify(reSearch));
        }
    }
    else displayProduct(productList2); //hiển thị sản phẩm
    
    function searchFromMain()
    {
        kq = [];
        var input = mainNameInput.toLowerCase();
        for(var i = 0; i<productList2.length;i++)
            if(productList2[i].name.toLowerCase().indexOf(input) > -1)
        kq.push(productList2[i]);
        displayProduct(kq);
    }

    function all1()
    {
        var type  = document.getElementById("type-output");
        type.innerHTML=
        '<h1 id="type-output">Tất Cả Mô Hình</h1>';
        productList2 = [];
        productList2 = productList;
        kq = productList2;
        displayProduct(kq);
        phanTrang(1);
    }

    function figure()
    {
        var type  = document.getElementById("type-output");
        type.innerHTML=
        '<h1 id="type-output">Mô Hình Lẻ</h1>';
        productList2 = [];
        for(var i=0;i<productList.length;i++)
        if(productList[i].type ==  1) productList2.push(productList[i]);
        kq = productList2;
        phanTrang(1);
    }

    function chibi()
    {
        var type  = document.getElementById("type-output");
        type.innerHTML=
        '<h1 id="type-output">Mô Hình Chibi</h1>';
        productList2 = [];
        for(var i=0;i<productList.length;i++)
        if(productList[i].type ==  2) productList2.push(productList[i]);
        kq = productList2;
        phanTrang(1);
    }

    function set()
    {
        var type  = document.getElementById("type-output");
        type.innerHTML=
        '<h1 id="type-output">Bộ Mô Hình</h1>';
        productList2 = [];
        for(var i=0;i<productList.length;i++)
        if(productList[i].type ==  3) productList2.push(productList[i]);
        kq = productList2;
        phanTrang(1);
    }

    function cosplay()
    {
        var type  = document.getElementById("type-output");
        type.innerHTML=
        '<h1 id="type-output">Cosplay</h1>';
        productList2 = [];
        for(var i=0;i<productList.length;i++)
        if(productList[i].type ==  4) productList2.push(productList[i]);
        kq = productList2;
        phanTrang(1);
    }

    var select = document.querySelector("#danh-muc-mobile select")
    select.addEventListener('change', function () {
        var selectOption = select.options[select.selectedIndex];
        if (selectOption.value === '0') all1();
        if (selectOption.value === '1') figure();
        if (selectOption.value === '2') chibi();
        if (selectOption.value === '3') set();
        if (selectOption.value === '4') cosplay();
    })
    var select2 = document.querySelector("#sort select")
    select2.addEventListener('change', function () {
        var selectOption2 = select2.options[select2.selectedIndex];
        if (selectOption2.value === 'nameup') nameup();
        if (selectOption2.value === 'namedown') namedown();
        if (selectOption2.value === 'priceup') priceup();
        if (selectOption2.value === 'pricedown') pricedown();
    })
    var select3 = document.querySelector("#productPerPage select")
    select3.addEventListener('change', function () {
        var selectOption3 = select3.options[select3.selectedIndex];
        productPerPage = parseFloat(selectOption3.value);
        phanTrang(1);
    })

    function nameup()
    {
        for(var i=0;i<kq.length;i++)
        {
            var index = i;
            for(var j=i+1;j<kq.length;j++)
            if(kq[index].name<kq[j].name) index = j;
            var c = kq[i];
            kq[i] = kq[index];
            kq[index] = c;
        }    
        phanTrang(1);
    }

    function namedown()
    {
        for(var i=0;i<kq.length;i++)
        {
            var index = i;
            for(var j=i+1;j<kq.length;j++)
            if(kq[index].name>kq[j].name) index = j;
            var c = kq[i];
            kq[i] = kq[index];
            kq[index] = c;
        }    
        phanTrang(1);
    }

    function priceup()
    {
        for(var i=0;i<kq.length;i++)
        {
            var index = i;
            for(var j=i+1;j<kq.length;j++)
            if(parseFloat(kq[index].price)>parseFloat(kq[j].price)) index = j;
            var c = kq[i];
            kq[i] = kq[index];
            kq[index] = c;
        }    
        phanTrang(1);
    }

    function pricedown()
    {
        for(var i=0;i<kq.length;i++)
        {
            var index = i;
            for(var j=i+1;j<kq.length;j++)
            if(parseFloat(kq[index].price)<parseFloat(kq[j].price)) index = j;
            var c = kq[i];
            kq[i] = kq[index];
            kq[index] = c;
        }    
        phanTrang(1);
    }

    function filterbyprice()
    {
        var min = document.getElementById("min-price").value;
        var max = document.getElementById("max-price").value;
        var search = document.getElementById("text-input-search").value.toLowerCase();
        min = parseFloat(min);
        max = parseFloat(max);
        kq = [];
        if (!min) min = 0;
        if (!max) max = Infinity;
        for(var i=0;i<productList2.length;i++)
        if(productList2[i].price>=min&&productList2[i].price<=max &&productList2[i].name.toLowerCase().indexOf(search) > -1) kq.push(productList2[i]);
        phanTrang(1);
    }

    phanTrang(currentPage);

    function phanTrang(Page)
    {   
        var PT = document.getElementById("phanTrang")
        PT.innerHTML = "";
        var max = Math.ceil(kq.length/productPerPage);
        for(var  i = 1;i<=max;i++)
        {   
            var p = document.createElement("p");
            p.className="outputPT";
            p.innerHTML = i;
            if(i==Page) p.style.backgroundColor = "red";
            p.onclick = function(index) {
            return function() {
            phanTrang(index);
            };
        }(i);
            PT.appendChild(p);
        }
        currentPage = Page;
        var after = [];
        var first = (currentPage-1)*productPerPage;
        var end = first + productPerPage;
        if(end > kq.length) end = kq.length;
        for(var i=first;i<end;i++)
        after.push(kq[i]);
        displayProduct(after);
    }

    function nextPage()
    {
        var max = Math.ceil(kq.length/productPerPage);
        if(currentPage == max) return;
        currentPage++;
        phanTrang(currentPage);
    }

    function previousPage()
    {
        if(currentPage == 1) return;
        currentPage--;
        phanTrang(currentPage);
    }

    var theme = 0;
    function darkLightMode()
    {   
        var color1 = document.getElementById("danh-muc");
        var color2 = document.getElementsByClassName("darkMode");
        var color3 = document.getElementById("sort-filter-productPerPage");
        var color4 = document.getElementsByClassName("xoa");
        var color5 = document.getElementById("type")
        var color6 = document.getElementById("archive-product");
        var color7 = document.getElementById("so-luong");
        var color10 = document.getElementById("phanTrang")
        var color11 = document.getElementById("img-theme");
        if(theme == 0) 
        {
            color1.style.backgroundColor = "rgb(50, 50, 50)";
            color3.style.backgroundColor = "rgb(50, 50, 50)";
            color5.style.backgroundColor = "rgb(50, 50, 50)";
            color6.style.backgroundColor = "rgb(50, 50, 50)";
            color7.style.backgroundColor = "rgb(50, 50, 50)";
            color10.style.backgroundColor = "rgb(50, 50, 50)";
            for(var i=0;i<color2.length;i++)
                color2[i].style.color = "white";
            for(var i=0;i<color4.length;i++)
                color4[i].style.color = "white";
            color11.src = "../asset/icon/Light_mode.png"
            theme = 1;
        }
        else
        {
            color1.style.backgroundColor = "rgb(238, 238, 238)";
            color3.style.backgroundColor = "rgb(238, 238, 238)";
            color5.style.backgroundColor = "rgb(238, 238, 238)";
            color6.style.backgroundColor = "rgb(238, 238, 238)";
            color7.style.backgroundColor = "rgb(238, 238, 238)";
            color10.style.backgroundColor = "rgb(238, 238, 238)";
            for(var i=0;i<color2.length;i++)
            color2[i].style.color = "black";
            for(var i=0;i<color4.length;i++)
            color4[i].style.color = "black";
            color11.src = "../asset/icon/dark_mode.png"
            theme = 0;
        }
    }
    function TKNC()
    {
        
    }
</script>
</html>
